<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
      <div class="d-flex flex-wrap gap-2 mb-4">
        <a class="btn btn-outline-primary d-flex flex-fill align-items-center gap-2 flex-sm-grow-0" role="button" href="#auditorias">
          {{ 'audits.compare.buttons.audits' | translate }}
        </a>
        <a class="btn btn-outline-primary d-flex flex-fill align-items-center gap-2 flex-sm-grow-0" role="button" href="#sitios">
          {{ 'audits.compare.buttons.sites' | translate }}
        </a>
      </div>
      <div class="card rounded-3 border-0 shadow-sm">
        <div class="card-body p-4 p-md-5">
          <div class="text-center mb-4">
            <h2 class="fw-bold text-primary mb-2">{{ 'audits.compare.title' | translate }}</h2>
            <p class="text-muted">{{ 'audits.compare.subtitle' | translate }}</p>
          </div>
          <form id="compareForm" class="needs-validation" [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="mb-4">
              <label class="form-label fw-semibold" for="baseWebPage">
                {{ 'audits.compare.basePage.label' | translate }} <span class="text-danger">*</span>
            </label>
              <select
                class="border-2 form-select form-select-lg form-select"
                id="baseWebPage"
                formControlName="web_page_id"
                aria-describedby="validationBaseWebPage"
                [ngClass]="{'is-invalid': messages('web_page_id').length > 0}"
              >
              <option value="" disabled>{{ 'audits.compare.basePage.placeholder' | translate }}</option>
              @for (audit of targetSearchList(); track audit.id){
                <option [value]="audit.id">{{audit.name}} ({{audit.url}})</option>
              }
            </select>
              @if(messages('web_page_id').length > 0){
                @for(msg of messages('web_page_id'); track msg){
                  <div id="validationWebPageId" class="invalid-feedback">
                    {{msg}}
                  </div>
                }
              } @else {
                <div class="form-text"><span>{{ 'audits.compare.basePage.help' | translate }}</span></div>
              }

            </div>
            <div class="mb-4"><label class="form-label fw-semibold">{{ 'audits.compare.comparePages.label' | translate }} <span class="text-danger">*</span></label>

              <!-- Filtros -->
              <div class="row g-2 mb-3">
                <div class="col-md-6">
                  <label class="form-label small">{{ 'audits.compare.filters.searchPage' | translate }}</label>
                  <input type="text"
                         class="form-control form-control-sm"
                         [placeholder]="'audits.compare.filters.searchPlaceholder' | translate"
                         [ngModel]="formTargetSearchListToCompare().query"
                         (ngModelChange)="updateQuery($event)"
                         [ngModelOptions]="{standalone: true}">
                </div>
              </div>

              <div class="bg-light border rounded-3 p-3">
                <div class="mb-3 form-text"><span>{{ 'audits.compare.comparePages.help' | translate }}</span></div>

                @if (loadingCompareList()) {
                  <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">{{ 'general.messages.loading' | translate }}</span>
                    </div>
                    <p class="text-muted mt-2 mb-0">{{ 'audits.compare.loading.searching' | translate }}</p>
                  </div>
                } @else if (targetSearchListToCompare().length === 0) {
                  <div class="text-center py-4">
                    <svg class="bi bi-inbox mb-3 text-muted" fill="currentColor" height="48" viewBox="0 0 16 16" width="48" xmlns="http://www.w3.org/2000/svg">
                      <path d="M4.98 4a.5.5 0 0 0-.39.188L1.54 8H6a.5.5 0 0 1 .5.5 1.5 1.5 0 1 0 3 0A.5.5 0 0 1 10 8h4.46l-3.05-3.812A.5.5 0 0 0 11.02 4zm9.954 5H10.45a2.5 2.5 0 0 1-4.9 0H1.066l.32 2.562a.5.5 0 0 0 .497.438h12.234a.5.5 0 0 0 .496-.438zM3.809 3.563A1.5 1.5 0 0 1 4.981 3h6.038a1.5 1.5 0 0 1 1.172.563l3.7 4.625a.5.5 0 0 1 .105.374l-.39 3.124A1.5 1.5 0 0 1 14.117 13H1.883a1.5 1.5 0 0 1-1.489-1.314l-.39-3.124a.5.5 0 0 1 .106-.374z"/>
                    </svg>
                    <p class="text-muted mb-0">{{ 'audits.compare.noResults.title' | translate }}</p>
                    <small class="text-muted">{{ 'audits.compare.noResults.subtitle' | translate }}</small>
                  </div>
                } @else {
                  @for (audit of targetSearchListToCompare(); track audit.id){
                    <div class="mb-3 form-check">
                      <input type="checkbox"
                             class="form-check-input"
                             [id]="'compare-' + audit.id"
                             [checked]="isPageSelected(audit.id)"
                             (change)="onComparePageChange(audit.id, $event)">
                      <label class="form-check-label text-truncate d-block"
                             [for]="'compare-' + audit.id"
                             [title]="audit.name + ' (' + audit.url + ')'">
                        {{audit.name}} ({{audit.url}})
                      </label>
                    </div>
                  }
                }
              </div>
              @if (submitted() && form.get('web_page_id_to_compare')?.invalid) {
                <div class="d-block invalid-feedback">
                  <span>{{ 'audits.compare.comparePages.required' | translate }}</span>
                </div>
              }
            </div>
            <div class="mb-4">
              <div class="form-check form-switch">
                <input type="checkbox"
                       class="form-check-input"
                       id="includeAiAnalysis"
                       formControlName="include_ai_analysis">
                <label class="fw-semibold form-check-label" for="includeAiAnalysis">
                  {{ 'audits.compare.includeAI.label' | translate }}
                </label>
              </div>
              <div class="form-text"><span>{{ 'audits.compare.includeAI.help' | translate }}</span></div>
            </div>
            <div class="d-grid d-md-flex gap-2 justify-content-md-end mt-5">
              <button class="btn btn-outline-secondary btn-lg px-4" type="reset">
                {{ 'general.actions.clear' | translate }}
              </button>
              <button class="btn btn-primary btn-lg shadow-sm px-5" type="submit">
                {{ 'audits.compare.buttons.compare' | translate }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>


<app-default-modal classModalDialog="modal-xl" [expanded]="showMessageConfirmation()">
  <app-header-modal classModal="text-white bg-primary">
    <h5 class="fw-bold modal-title" id="resultsModalLabel">
      {{ 'audits.compare.confirmModal.resultsTitle' | translate }}
    </h5>
    <button class="btn-close btn-close-white" aria-label="Close" (click)="showMessageConfirmation.set(false)" type="button"></button>
  </app-header-modal>

  <app-body-modal>
    <!-- URL Base -->
    <div class="mb-4">
      <h6 class="fw-bold text-primary">
        <i class="bi bi-globe me-2"></i>{{ 'audits.compare.confirmModal.basePageLabel' | translate }}
      </h6>
      <p class="mb-0">
        <a class="text-decoration-none text-truncate d-inline-block"
           style="max-width: 100%;"
           [href]="responseCompareAudit()?.base_url"
           target="_blank"
           [title]="responseCompareAudit()?.base_url">
          <i class="bi bi-box-arrow-up-right me-1 small"></i>{{ responseCompareAudit()?.base_url }}
        </a>
      </p>
    </div>

    <!-- Análisis IA Schema -->
    @if (responseCompareAudit()?.ai_schema_comparison) {
      <div class="alert alert-info border-0 shadow-sm mb-4" role="alert">
        <h6 class="fw-bold mb-2">
          <svg class="bi bi-robot me-2" fill="currentColor" height="20" viewBox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.6 26.6 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.93.93 0 0 1-.765.935c-.845.147-2.34.346-4.235.346s-3.39-.2-4.235-.346A.93.93 0 0 1 3 9.219zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a25 25 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25 25 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135"/>
            <path d="M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2zM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5"/>
          </svg>
          {{ 'audits.compare.confirmModal.aiSchemaAnalysis' | translate }}
        </h6>
        <div class="ai-content" style="max-height: 200px; overflow-y: auto;">
          <div [innerHTML]="responseCompareAudit()?.ai_schema_comparison"></div>
        </div>
      </div>
    }

    <!-- Resumen General -->
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-header bg-white border-0 pt-3">
        <h6 class="fw-bold text-primary mb-0">
          <i class="bi bi-bar-chart me-2"></i>{{ 'audits.compare.confirmModal.overallSummary' | translate }}
        </h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <!-- Total Competitors -->
          <div class="col-6 col-md-3">
            <div class="bg-light rounded-3 p-3 h-100 text-center">
              <small class="text-muted d-block mb-1">{{ 'audits.compare.confirmModal.totalCompetitors' | translate }}</small>
              <span class="fs-3 fw-bold text-primary">{{ responseCompareAudit()?.overall_summary?.total_competitors }}</span>
            </div>
          </div>

          <!-- Performance Rank -->
          <div class="col-6 col-md-3">
            <div class="bg-light rounded-3 p-3 h-100 text-center">
              <small class="text-muted d-block mb-1">{{ 'audits.compare.confirmModal.performanceRank' | translate }}</small>
              <div class="d-flex align-items-center justify-content-center gap-1">
                <span class="badge fs-6" [ngClass]="responseCompareAudit()?.overall_summary?.is_best_performance ? 'bg-success' : 'bg-secondary'">
                  {{ responseCompareAudit()?.overall_summary?.performance_rank }}
                </span>
                @if (responseCompareAudit()?.overall_summary?.is_best_performance) {
                  <i class="bi bi-trophy-fill text-warning"></i>
                }
              </div>
            </div>
          </div>

          <!-- SEO Rank -->
          <div class="col-6 col-md-3">
            <div class="bg-light rounded-3 p-3 h-100 text-center">
              <small class="text-muted d-block mb-1">{{ 'audits.compare.confirmModal.seoRank' | translate }}</small>
              <div class="d-flex align-items-center justify-content-center gap-1">
                <span class="badge fs-6" [ngClass]="responseCompareAudit()?.overall_summary?.is_best_seo ? 'bg-success' : 'bg-secondary'">
                  {{ responseCompareAudit()?.overall_summary?.seo_rank }}
                </span>
                @if (responseCompareAudit()?.overall_summary?.is_best_seo) {
                  <i class="bi bi-trophy-fill text-warning"></i>
                }
              </div>
            </div>
          </div>

          <!-- Areas to Improve -->
          <div class="col-6 col-md-3">
            <div class="bg-light rounded-3 p-3 h-100">
              <small class="text-muted d-block mb-1">{{ 'audits.compare.confirmModal.areasToImprove' | translate }}</small>
              @if (responseCompareAudit()?.overall_summary?.areas_to_improve?.length) {
                <div class="d-flex flex-wrap gap-1">
                  @for (area of responseCompareAudit()?.overall_summary?.areas_to_improve; track area) {
                    <span class="badge bg-danger">{{ area }}</span>
                  }
                </div>
              } @else {
                <span class="badge bg-success">
                  <i class="bi bi-check-circle me-1"></i>{{ 'audits.compare.confirmModal.noAreasToImprove' | translate }}
                </span>
              }
            </div>
          </div>
        </div>

        <!-- Competitive Advantage -->
        <div class="row g-3 mt-2">
          <div class="col-12">
            <div class="bg-gradient rounded-3 p-3" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
              <small class="text-muted d-block mb-2 fw-semibold">
                <i class="bi bi-graph-up-arrow me-1"></i>{{ 'audits.compare.confirmModal.competitiveAdvantage' | translate }}
              </small>
              <div class="d-flex gap-3 flex-wrap">
                <div class="d-flex align-items-center gap-2">
                  <span class="badge rounded-pill" [ngClass]="responseCompareAudit()?.overall_summary?.competitive_advantage?.performance_above_average ? 'bg-success' : 'bg-secondary'">
                    <i class="bi me-1" [ngClass]="responseCompareAudit()?.overall_summary?.competitive_advantage?.performance_above_average ? 'bi-check-lg' : 'bi-x-lg'"></i>
                    {{ 'audits.compare.confirmModal.performanceAboveAverage' | translate }}
                  </span>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <span class="badge rounded-pill" [ngClass]="responseCompareAudit()?.overall_summary?.competitive_advantage?.seo_above_average ? 'bg-success' : 'bg-secondary'">
                    <i class="bi me-1" [ngClass]="responseCompareAudit()?.overall_summary?.competitive_advantage?.seo_above_average ? 'bi-check-lg' : 'bi-x-lg'"></i>
                    {{ 'audits.compare.confirmModal.seoAboveAverage' | translate }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Recommendations -->
    @if (responseCompareAudit()?.overall_summary?.top_recommendations?.length) {
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-0 pt-3">
          <h6 class="fw-bold text-primary mb-0">
            <i class="bi bi-star me-2"></i>{{ 'audits.compare.confirmModal.topRecommendations' | translate }}
          </h6>
        </div>
        <div class="card-body p-0">
          <div class="list-group list-group-flush">
            @for (rec of responseCompareAudit()?.overall_summary?.top_recommendations; track rec.title) {
              <div class="list-group-item border-0 border-bottom">
                <div class="d-flex w-100 justify-content-between align-items-start">
                  <div class="flex-grow-1">
                    <h6 class="mb-1 fw-semibold">{{ rec.title }}</h6>
                    @if (rec.description) {
                      <p class="mb-1 text-muted small">{{ rec.description }}</p>
                    }
                    @if (rec.action) {
                      <small class="text-info">
                        <i class="bi bi-lightbulb me-1"></i>{{ rec.action }}
                      </small>
                    }
                  </div>
                  <span class="badge rounded-pill ms-2 flex-shrink-0" [ngClass]="{
                    'bg-danger': rec.priority === 'high',
                    'bg-warning text-dark': rec.priority === 'medium',
                    'bg-info': rec.priority === 'low'
                  }">
                    {{ rec.priority }}
                  </span>
                </div>
                <div class="mt-2 d-flex flex-wrap gap-2 align-items-center">
                  <small class="text-muted">
                    <i class="bi bi-tag me-1"></i>{{ rec.category }}
                  </small>
                  @if (rec.current_value !== undefined && rec.target_value !== undefined) {
                    <small class="text-muted">
                      <i class="bi bi-arrow-right me-1"></i>
                      <span class="text-danger">{{ rec.current_value | number:'1.0-1' }}</span>
                      →
                      <span class="text-success">{{ rec.target_value | number:'1.0-1' }}</span>
                    </small>
                  }
                  @if (rec.missing_schemas?.length) {
                    <div class="d-flex flex-wrap gap-1">
                      @for (schema of rec.missing_schemas; track schema) {
                        @if (schema) {
                          <span class="badge bg-outline-secondary border small">{{ schema }}</span>
                        }
                      }
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    }

    <!-- Detailed Comparisons -->
    <h6 class="fw-bold text-primary mb-3">
      <i class="bi bi-list-columns-reverse me-2"></i>{{ 'audits.compare.confirmModal.detailedComparisons' | translate }}
    </h6>

    <div class="accordion" role="tablist" id="comparisonsAccordion">
      @for (comparison of responseCompareAudit()?.comparisons; track comparison.compare_url; let i = $index) {
        <div class="accordion-item border-0 shadow-sm mb-3 rounded-3 overflow-hidden">
          <h2 class="accordion-header" role="tab" [id]="'heading' + i">
            <button class="accordion-button" [class.collapsed]="i !== 0" type="button"
                    data-bs-toggle="collapse" [attr.data-bs-target]="'#collapse' + i"
                    [attr.aria-expanded]="i === 0" [attr.aria-controls]="'collapse' + i">
              <div class="d-flex align-items-center justify-content-between w-100 pe-3">
                <span class="fw-semibold text-truncate" style="max-width: 55%;" [title]="comparison.compare_url">
                  <i class="bi bi-link-45deg me-1"></i>{{ comparison.compare_url }}
                </span>
                <span class="badge rounded-pill flex-shrink-0" [ngClass]="{
                  'bg-success': comparison.summary.overall_winner === 'base',
                  'bg-warning text-dark': comparison.summary.overall_winner === 'tie',
                  'bg-danger': comparison.summary.overall_winner === 'compare'
                }">
                  <i class="bi bi-trophy me-1"></i>{{ 'audits.compare.confirmModal.winner' | translate }}: {{ comparison.summary.overall_winner }}
                </span>
              </div>
            </button>
          </h2>

          <div [id]="'collapse' + i" class="accordion-collapse collapse" [class.show]="i === 0"
               role="tabpanel" data-bs-parent="#comparisonsAccordion" [attr.aria-labelledby]="'heading' + i">
            <div class="accordion-body">

              <!-- Comparison Date -->
              <div class="mb-3 text-muted small d-flex align-items-center">
                <i class="bi bi-calendar3 me-2"></i>
                {{ 'audits.compare.confirmModal.comparisonDate' | translate }}:
                <strong class="ms-1">{{ comparison.comparison_date | date:'medium' }}</strong>
              </div>

              <!-- Performance Scores Card -->
              <div class="card border mb-4">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                  <h6 class="mb-0 fw-semibold">
                    <i class="bi bi-speedometer2 me-2 text-primary"></i>{{ 'audits.compare.confirmModal.performanceScores' | translate }}
                  </h6>
                  <span class="badge rounded-pill" [ngClass]="comparison.performance.overall_better === 'base' ? 'bg-success' : 'bg-warning text-dark'">
                    {{ 'audits.compare.confirmModal.better' | translate }}: {{ comparison.performance.overall_better }}
                  </span>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <!-- Performance Score -->
                    <div class="col-6 col-lg-3">
                      <div class="border rounded-3 p-3 h-100 text-center">
                        <small class="text-muted d-block mb-2 fw-semibold">Performance</small>
                        <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
                          <span class="fs-4 fw-bold text-primary">{{ comparison.performance.scores.performance_score.base }}</span>
                          <small class="text-muted">vs</small>
                          <span class="fs-5 fw-bold text-secondary">{{ comparison.performance.scores.performance_score.compare }}</span>
                        </div>
                        <span class="badge rounded-pill" [ngClass]="{
                          'bg-success': comparison.performance.scores.performance_score.is_better,
                          'bg-danger': !comparison.performance.scores.performance_score.is_better && comparison.performance.scores.performance_score.status !== 'similar',
                          'bg-secondary': comparison.performance.scores.performance_score.status === 'similar'
                        }">
                          {{ comparison.performance.scores.performance_score.status }}
                        </span>
                      </div>
                    </div>

                    <!-- SEO Score -->
                    <div class="col-6 col-lg-3">
                      <div class="border rounded-3 p-3 h-100 text-center">
                        <small class="text-muted d-block mb-2 fw-semibold">SEO</small>
                        <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
                          <span class="fs-4 fw-bold text-primary">{{ comparison.performance.scores.seo_score.base }}</span>
                          <small class="text-muted">vs</small>
                          <span class="fs-5 fw-bold text-secondary">{{ comparison.performance.scores.seo_score.compare }}</span>
                        </div>
                        <span class="badge rounded-pill" [ngClass]="{
                          'bg-success': comparison.performance.scores.seo_score.is_better,
                          'bg-danger': !comparison.performance.scores.seo_score.is_better && comparison.performance.scores.seo_score.status !== 'similar',
                          'bg-secondary': comparison.performance.scores.seo_score.status === 'similar'
                        }">
                          {{ comparison.performance.scores.seo_score.status }}
                        </span>
                      </div>
                    </div>

                    <!-- Accessibility Score -->
                    <div class="col-6 col-lg-3">
                      <div class="border rounded-3 p-3 h-100 text-center">
                        <small class="text-muted d-block mb-2 fw-semibold">Accessibility</small>
                        <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
                          <span class="fs-4 fw-bold text-primary">{{ comparison.performance.scores.accessibility_score.base | number:'1.0-0' }}</span>
                          <small class="text-muted">vs</small>
                          <span class="fs-5 fw-bold text-secondary">{{ comparison.performance.scores.accessibility_score.compare | number:'1.0-0' }}</span>
                        </div>
                        <span class="badge rounded-pill" [ngClass]="{
                          'bg-success': comparison.performance.scores.accessibility_score.is_better,
                          'bg-danger': !comparison.performance.scores.accessibility_score.is_better && comparison.performance.scores.accessibility_score.status !== 'similar',
                          'bg-secondary': comparison.performance.scores.accessibility_score.status === 'similar'
                        }">
                          {{ comparison.performance.scores.accessibility_score.status }}
                        </span>
                      </div>
                    </div>

                    <!-- Best Practices Score -->
                    <div class="col-6 col-lg-3">
                      <div class="border rounded-3 p-3 h-100 text-center">
                        <small class="text-muted d-block mb-2 fw-semibold">Best Practices</small>
                        <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
                          <span class="fs-4 fw-bold text-primary">{{ comparison.performance.scores.best_practices_score.base }}</span>
                          <small class="text-muted">vs</small>
                          <span class="fs-5 fw-bold text-secondary">{{ comparison.performance.scores.best_practices_score.compare }}</span>
                        </div>
                        <span class="badge rounded-pill" [ngClass]="{
                          'bg-success': comparison.performance.scores.best_practices_score.is_better,
                          'bg-danger': !comparison.performance.scores.best_practices_score.is_better && comparison.performance.scores.best_practices_score.status !== 'similar',
                          'bg-secondary': comparison.performance.scores.best_practices_score.status === 'similar'
                        }">
                          {{ comparison.performance.scores.best_practices_score.status }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Schemas Card -->
              <div class="card border mb-4">
                <div class="card-header bg-light">
                  <h6 class="mb-0 fw-semibold">
                    <i class="bi bi-code-slash me-2 text-primary"></i>{{ 'audits.compare.confirmModal.schemas' | translate }}
                    <span class="badge bg-primary ms-2">{{ comparison.schemas.base_count }}</span>
                    <small class="text-muted mx-1">vs</small>
                    <span class="badge bg-secondary">{{ comparison.schemas.compare_count }}</span>
                  </h6>
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <!-- Base Schemas -->
                    <div class="col-md-6">
                      <div class="border rounded-3 p-3 h-100">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-check-circle text-primary me-1"></i>{{ 'audits.compare.confirmModal.baseSchemas' | translate }}
                        </small>
                        <div class="d-flex flex-wrap gap-1">
                          @for (schema of comparison.schemas.base_schemas; track schema) {
                            @if (schema) {
                              <span class="badge bg-primary">{{ schema }}</span>
                            }
                          }
                          @if (!comparison.schemas.base_schemas?.length || (comparison.schemas.base_schemas.length === 1 && !comparison.schemas.base_schemas[0])) {
                            <span class="text-muted fst-italic">{{ 'audits.compare.confirmModal.noSchemas' | translate }}</span>
                          }
                        </div>
                      </div>
                    </div>

                    <!-- Compare Schemas -->
                    <div class="col-md-6">
                      <div class="border rounded-3 p-3 h-100">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-circle text-secondary me-1"></i>{{ 'audits.compare.confirmModal.compareSchemas' | translate }}
                        </small>
                        <div class="d-flex flex-wrap gap-1">
                          @for (schema of comparison.schemas.compare_schemas; track schema) {
                            @if (schema) {
                              <span class="badge bg-secondary">{{ schema }}</span>
                            }
                          }
                          @if (!comparison.schemas.compare_schemas?.length || (comparison.schemas.compare_schemas.length === 1 && !comparison.schemas.compare_schemas[0])) {
                            <span class="text-muted fst-italic">{{ 'audits.compare.confirmModal.noSchemas' | translate }}</span>
                          }
                        </div>
                      </div>
                    </div>

                    <!-- Unique to Base -->
                    <div class="col-md-6">
                      <div class="border border-success rounded-3 p-3 h-100 bg-success bg-opacity-10">
                        <small class="text-success d-block mb-2 fw-semibold">
                          <i class="bi bi-plus-circle me-1"></i>{{ 'audits.compare.confirmModal.uniqueToBase' | translate }}
                        </small>
                        <div class="d-flex flex-wrap gap-1">
                          @for (schema of comparison.schemas.unique_to_base; track schema) {
                            @if (schema) {
                              <span class="badge bg-success">{{ schema }}</span>
                            }
                          }
                          @if (!comparison.schemas.unique_to_base?.length) {
                            <span class="text-muted fst-italic">-</span>
                          }
                        </div>
                      </div>
                    </div>

                    <!-- Missing in Base -->
                    <div class="col-md-6">
                      <div class="border border-danger rounded-3 p-3 h-100 bg-danger bg-opacity-10">
                        <small class="text-danger d-block mb-2 fw-semibold">
                          <i class="bi bi-dash-circle me-1"></i>{{ 'audits.compare.confirmModal.missingInBase' | translate }}
                        </small>
                        <div class="d-flex flex-wrap gap-1">
                          @for (schema of comparison.schemas.missing_in_base; track schema) {
                            @if (schema) {
                              <span class="badge bg-danger">{{ schema }}</span>
                            }
                          }
                          @if (!comparison.schemas.missing_in_base?.length || (comparison.schemas.missing_in_base.length === 1 && !comparison.schemas.missing_in_base[0])) {
                            <span class="text-muted fst-italic">-</span>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- SEO Analysis Card -->
              <div class="card border mb-4">
                <div class="card-header bg-light">
                  <h6 class="mb-0 fw-semibold">
                    <i class="bi bi-search me-2 text-primary"></i>{{ 'audits.compare.confirmModal.seoAnalysis' | translate }}
                  </h6>
                </div>
                <div class="card-body">
                  <!-- Title & Meta Description -->
                  <div class="row g-3 mb-3">
                    <div class="col-md-6">
                      <div class="border rounded-3 p-3">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-type me-1"></i>{{ 'audits.compare.confirmModal.titleComparison' | translate }}
                        </small>
                        <div class="d-flex justify-content-between align-items-center">
                          <span class="badge" [ngClass]="comparison.seo_analysis.onpage.title_comparison.base_status === 'Good' ? 'bg-success' : 'bg-warning text-dark'">
                            Base: {{ comparison.seo_analysis.onpage.title_comparison.base_length }} chars
                          </span>
                          <span class="badge" [ngClass]="comparison.seo_analysis.onpage.title_comparison.compare_status === 'Good' ? 'bg-success' : 'bg-warning text-dark'">
                            Compare: {{ comparison.seo_analysis.onpage.title_comparison.compare_length }} chars
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="border rounded-3 p-3">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-card-text me-1"></i>{{ 'audits.compare.confirmModal.metaDescComparison' | translate }}
                        </small>
                        <div class="d-flex justify-content-between align-items-center">
                          <span class="badge" [ngClass]="comparison.seo_analysis.onpage.meta_description_comparison.base_status === 'Good' ? 'bg-success' : 'bg-warning text-dark'">
                            Base: {{ comparison.seo_analysis.onpage.meta_description_comparison.base_length }} chars
                          </span>
                          <span class="badge" [ngClass]="comparison.seo_analysis.onpage.meta_description_comparison.compare_status === 'Good' ? 'bg-success' : 'bg-warning text-dark'">
                            Compare: {{ comparison.seo_analysis.onpage.meta_description_comparison.compare_length }} chars
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Headers & Links Tables -->
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="border rounded-3 p-3">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-list-ol me-1"></i>{{ 'audits.compare.confirmModal.headersStructure' | translate }}
                        </small>
                        <div class="table-responsive">
                          <table class="table table-sm table-borderless mb-0 text-center">
                            <thead class="table-light">
                            <tr>
                              <th></th>
                              <th>H1</th>
                              <th>H2</th>
                              <th>H3</th>
                              <th>H4</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                              <td class="text-start"><span class="badge bg-primary">Base</span></td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.base_structure.h1 }}</td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.base_structure.h2 }}</td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.base_structure.h3 }}</td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.base_structure.h4 }}</td>
                            </tr>
                            <tr>
                              <td class="text-start"><span class="badge bg-secondary">Compare</span></td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.compare_structure.h1 }}</td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.compare_structure.h2 }}</td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.compare_structure.h3 }}</td>
                              <td>{{ comparison.seo_analysis.onpage.headers_comparison.compare_structure.h4 }}</td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="border rounded-3 p-3">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-link-45deg me-1"></i>{{ 'audits.compare.confirmModal.linksComparison' | translate }}
                        </small>
                        <div class="table-responsive">
                          <table class="table table-sm table-borderless mb-0 text-center">
                            <thead class="table-light">
                            <tr>
                              <th></th>
                              <th>Total</th>
                              <th>Internal</th>
                              <th>External</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                              <td class="text-start"><span class="badge bg-primary">Base</span></td>
                              <td>{{ comparison.seo_analysis.onpage.links_comparison.base_total }}</td>
                              <td>{{ comparison.seo_analysis.onpage.links_comparison.base_internal }}</td>
                              <td>{{ comparison.seo_analysis.onpage.links_comparison.base_external }}</td>
                            </tr>
                            <tr>
                              <td class="text-start"><span class="badge bg-secondary">Compare</span></td>
                              <td>{{ comparison.seo_analysis.onpage.links_comparison.compare_total }}</td>
                              <td>{{ comparison.seo_analysis.onpage.links_comparison.compare_internal }}</td>
                              <td>{{ comparison.seo_analysis.onpage.links_comparison.compare_external }}</td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Technical SEO - Robots.txt -->
                  <div class="row g-3 mt-2">
                    <div class="col-12">
                      <div class="border rounded-3 p-3">
                        <small class="text-muted d-block mb-2 fw-semibold">
                          <i class="bi bi-file-earmark-code me-1"></i>{{ 'audits.compare.confirmModal.robotsTxt' | translate }}
                        </small>
                        <div class="d-flex gap-4 flex-wrap">
                          <div class="d-flex align-items-center gap-2">
                            <span class="badge" [ngClass]="comparison.seo_analysis.technical.robots_txt.base_exists ? 'bg-success' : 'bg-danger'">
                              <i class="bi me-1" [ngClass]="comparison.seo_analysis.technical.robots_txt.base_exists ? 'bi-check-lg' : 'bi-x-lg'"></i>
                              Base
                            </span>
                            <small class="text-muted">{{ comparison.seo_analysis.technical.robots_txt.base_sitemaps }} sitemaps</small>
                          </div>
                          <div class="d-flex align-items-center gap-2">
                            <span class="badge" [ngClass]="comparison.seo_analysis.technical.robots_txt.compare_exists ? 'bg-success' : 'bg-danger'">
                              <i class="bi me-1" [ngClass]="comparison.seo_analysis.technical.robots_txt.compare_exists ? 'bi-check-lg' : 'bi-x-lg'"></i>
                              Compare
                            </span>
                            <small class="text-muted">{{ comparison.seo_analysis.technical.robots_txt.compare_sitemaps }} sitemaps</small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Recommendations Card -->
              @if (comparison.recommendations?.length) {
                <div class="card border mb-4">
                  <div class="card-header bg-light">
                    <h6 class="mb-0 fw-semibold">
                      <i class="bi bi-lightbulb me-2 text-warning"></i>{{ 'audits.compare.confirmModal.recommendations' | translate }}
                      <span class="badge bg-secondary ms-2">{{ comparison.recommendations.length }}</span>
                    </h6>
                  </div>
                  <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                      @for (recommendation of comparison.recommendations; track recommendation.title) {
                        <div class="list-group-item">
                          <div class="d-flex w-100 justify-content-between align-items-start">
                            <div class="flex-grow-1">
                              <h6 class="mb-1 fw-semibold">{{ recommendation.title }}</h6>
                              @if (recommendation.description) {
                                <p class="mb-1 text-muted small">{{ recommendation.description }}</p>
                              }
                              @if (recommendation.action) {
                                <small class="text-info">
                                  <i class="bi bi-arrow-right-circle me-1"></i>{{ recommendation.action }}
                                </small>
                              }
                            </div>
                            <span class="badge rounded-pill ms-2 flex-shrink-0" [ngClass]="{
                              'bg-danger': recommendation.priority === 'high',
                              'bg-warning text-dark': recommendation.priority === 'medium',
                              'bg-info': recommendation.priority === 'low'
                            }">
                              {{ recommendation.priority }}
                            </span>
                          </div>
                          <div class="mt-2 d-flex flex-wrap gap-2 align-items-center">
                            <small class="text-muted">
                              <i class="bi bi-tag me-1"></i>{{ recommendation.category }}
                            </small>
                            @if (recommendation.current_value !== undefined && recommendation.target_value !== undefined) {
                              <small class="text-muted">
                                <span class="text-danger">{{ recommendation.current_value | number:'1.0-1' }}</span>
                                <i class="bi bi-arrow-right mx-1"></i>
                                <span class="text-success">{{ recommendation.target_value | number:'1.0-1' }}</span>
                              </small>
                            }
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                </div>
              }

              <!-- AI Analysis Card -->
              @if (comparison.ai_analysis) {
                <div class="card border border-info">
                  <div class="card-header bg-info bg-opacity-10">
                    <h6 class="mb-0 fw-semibold text-info">
                      <svg class="bi bi-robot me-2" fill="currentColor" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.6 26.6 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.93.93 0 0 1-.765.935c-.845.147-2.34.346-4.235.346s-3.39-.2-4.235-.346A.93.93 0 0 1 3 9.219zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a25 25 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25 25 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135"/>
                        <path d="M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2zM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5"/>
                      </svg>
                      {{ 'audits.compare.confirmModal.aiAnalysis' | translate }}
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="ai-analysis-content" style="max-height: 400px; overflow-y: auto;">
                      <pre class="mb-0" style="white-space: pre-wrap; word-wrap: break-word; font-family: inherit; font-size: 0.875rem;">{{ comparison.ai_analysis }}</pre>
                    </div>
                  </div>
                </div>
              }

            </div>
          </div>
        </div>
      }
    </div>

  </app-body-modal>

  <app-footer-modal>
    <button class="btn btn-outline-secondary" type="button" (click)="showMessageConfirmation.set(false)">
      <i class="bi bi-x-lg me-1"></i>{{ 'audits.compare.confirmModal.closeButton' | translate }}
    </button>
    <button class="btn btn-primary" type="button">
      <i class="bi bi-download me-1"></i>{{ 'audits.compare.confirmModal.exportButton' | translate }}
    </button>
  </app-footer-modal>
</app-default-modal>
