<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-xl-9">
      <div class="d-flex flex-wrap gap-2 mb-4"><a class="btn btn-outline-primary d-flex flex-fill align-items-center gap-2 flex-sm-grow-0" role="button" href="#auditorias"> Auditorías </a><a class="btn btn-outline-primary d-flex flex-fill align-items-center gap-2 flex-sm-grow-0" role="button" href="#sitios"> Listado de Sitios </a></div>
      <div class="card rounded-3 border-0 shadow-sm">
        <div class="card-body p-4 p-md-5">
          <div class="text-center mb-4">
            <h2 class="fw-bold text-primary mb-2">Comparativa de Páginas Web</h2>
            <p class="text-muted">Seleccione una página web base y las páginas con las que desea compararla</p>
          </div>
          <form id="compareForm" class="needs-validation" [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="mb-4">
              <label class="form-label fw-semibold" for="baseWebPage">
                Página Web Base <span class="text-danger">*</span>
            </label>
              <select
                class="border-2 form-select form-select-lg form-select"
                id="baseWebPage"
                formControlName="web_page_id"
                aria-describedby="validationBaseWebPage"
                [ngClass]="{'is-invalid': messages('web_page_id').length > 0}"
              >
              <option value="" disabled>Seleccione una página web...</option>
              @for (audit of auditSearchList(); track audit.id){
                <option [value]="audit.id">{{audit.web_page_name}} ({{audit.web_page_url}})</option>
              }
            </select>
              @if(messages('web_page_id').length > 0){
                @for(msg of messages('web_page_id'); track msg){
                  <div id="validationWebPageId" class="invalid-feedback">
                    {{msg}}
                  </div>
                }
              } @else {
                <div class="form-text"><span>Seleccione la página web que será la base de la comparación</span></div>
              }

            </div>
            <div class="mb-4"><label class="form-label fw-semibold">Páginas Web para Comparar <span class="text-danger">*</span></label>

              <!-- Filtros -->
              <div class="row g-2 mb-3">
                <div class="col-md-4 d-flex align-items-end">
                  <label class="form-label small mb-1 mx-2">Solo páginas únicas</label>
                  <div class="form-check form-switch mt-2">
                    <input type="checkbox"
                           class="form-check-input"
                           [ngModel]="formAuditSearchListToCompare().unique_web_page"
                           (ngModelChange)="updateUniqueWebPage($event)"
                           [ngModelOptions]="{standalone: true}"
                           id="uniqueWebPageFilter">
                    <label class="form-check-label small" for="uniqueWebPageFilter">
                      Activar
                    </label>
                  </div>
                </div>
              </div>

              <div class="bg-light border rounded-3 p-3">
                <div class="mb-3 form-text"><span>Seleccione una o más páginas web para comparar con la base</span></div>
                @for (audit of auditSearchListToCompare(); track audit.id){
                  <div class="mb-3 form-check">
                    <input type="checkbox"
                           class="form-check-input"
                           [id]="'compare-' + audit.id"
                           [checked]="isPageSelected(audit.id)"
                           (change)="onComparePageChange(audit.id, $event)">
                    <label class="form-check-label" [for]="'compare-' + audit.id">
                      {{audit.web_page_name}} ({{audit.web_page_url}})
                    </label>
                  </div>
                }
              </div>
              @if (submitted() && form.get('web_page_id_compare')?.invalid) {
                <div class="d-block invalid-feedback">
                  <span>Por favor seleccione al menos una página para comparar.</span>
                </div>
              }
            </div>
            <div class="mb-4">
              <div class="form-check form-switch">
                <input type="checkbox"
                       class="form-check-input"
                       id="includeAiAnalysis"
                       formControlName="include_ai_analysis">
                <label class="fw-semibold form-check-label" for="includeAiAnalysis">
                  Incluir Análisis con IA
                </label>
              </div>
              <div class="form-text"><span>Active esta opción para obtener recomendaciones generadas por inteligencia artificial</span></div>
            </div>
            <div class="d-grid d-md-flex gap-2 justify-content-md-end mt-5"><button class="btn btn-outline-secondary btn-lg px-4" type="reset"> Limpiar </button><button class="btn btn-primary btn-lg shadow-sm px-5" type="submit"> Generar Comparativa </button></div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" role="dialog" tabindex="-1" id="resultsModal" aria-labelledby="resultsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header text-white bg-primary">
        <h5 class="fw-bold modal-title" id="resultsModalLabel">Resultados de la Comparativa</h5><button class="btn-close btn-close-white" aria-label="Close" data-bs-dismiss="modal" type="button"></button>
      </div>
      <div class="modal-body">
        <div class="mb-4">
          <h6 class="fw-bold text-primary">Página Web Base</h6>
          <p class="mb-0"><a class="text-decoration-none" href="https://example.com" target="_blank">https://example.com</a></p>
        </div>
        <div class="alert alert-info border-0 shadow-sm mb-4" role="alert">
          <h6 class="fw-bold mb-2"><svg class="bi bi-robot me-2" fill="currentColor" height="20" viewbox="0 0 16 16" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.6 26.6 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.93.93 0 0 1-.765.935c-.845.147-2.34.346-4.235.346s-3.39-.2-4.235-.346A.93.93 0 0 1 3 9.219zm4.542-.827a.25.25 0 0 0-.217.068l-.92.9a25 25 0 0 1-1.871-.183.25.25 0 0 0-.068.495c.55.076 1.232.149 2.02.193a.25.25 0 0 0 .189-.071l.754-.736.847 1.71a.25.25 0 0 0 .404.062l.932-.97a25 25 0 0 0 1.922-.188.25.25 0 0 0-.068-.495c-.538.074-1.207.145-1.98.189a.25.25 0 0 0-.166.076l-.754.785-.842-1.7a.25.25 0 0 0-.182-.135"></path><path d="M8.5 1.866a1 1 0 1 0-1 0V3h-2A4.5 4.5 0 0 0 1 7.5V8a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1v1a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-1a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1v-.5A4.5 4.5 0 0 0 10.5 3h-2zM14 7.5V13a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7.5A3.5 3.5 0 0 1 5.5 4h5A3.5 3.5 0 0 1 14 7.5"></path></svg> Análisis con IA </h6>
          <p class="mb-0">El sitio base tiene un 80% de schemas implementados, mientras que los competidores tienen un promedio del 65%. Se recomienda añadir los siguientes schemas: Product, FAQ, HowTo.</p>
        </div>
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-white border-0 pt-3">
            <h6 class="fw-bold text-primary mb-0">Resumen General</h6>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <div class="bg-light rounded-3 p-3"><small class="text-muted d-block mb-1">Mejor en Rendimiento</small><span class="badge bg-success">Base</span></div>
              </div>
              <div class="col-md-4">
                <div class="bg-light rounded-3 p-3"><small class="text-muted d-block mb-1">Mejor en SEO</small><span class="badge bg-warning text-dark">competitor1</span></div>
              </div>
              <div class="col-md-4">
                <div class="bg-light rounded-3 p-3"><small class="text-muted d-block mb-1">Áreas a Mejorar</small><span class="badge bg-danger me-1">schema_markup</span><span class="badge bg-danger">core_web_vitals</span></div>
              </div>
            </div>
          </div>
        </div>
        <h6 class="fw-bold text-primary mb-3">Comparaciones Detalladas</h6>
        <div class="accordion" role="tablist" id="comparisonsAccordion">
          <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header" role="tab" id="heading1"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse1" aria-expanded="true" aria-controls="collapse1"><div class="d-flex align-items-center justify-content-between w-100 pe-3"><span class="fw-semibold">https://competitor1.com</span><span class="badge bg-success">Ganador: Base</span></div></button></h2>
            <div class="accordion-collapse collapse show item-1 show" role="tabpanel" data-bs-parent="#comparisonsAccordion" aria-labelledby="heading1" id="collapse1">
              <div class="accordion-body">
                <h6 class="fw-bold mb-3">Recomendaciones</h6>
                <div class="list-group">
                  <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between align-items-center">
                      <h6 class="mb-1">Implementar schemas faltantes</h6><span class="badge bg-danger">Prioridad Alta</span>
                    </div><small class="text-muted">Categoría: schema_markup</small>
                  </div>
                  <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between align-items-center">
                      <h6 class="mb-1">Optimizar Core Web Vitals</h6><span class="badge bg-warning text-dark">Prioridad Media</span>
                    </div><small class="text-muted">Categoría: core_web_vitals</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header" role="tab" id="heading2"><button class="accordion-button collapsed collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2" aria-expanded="false" aria-controls="collapse2"><div class="d-flex align-items-center justify-content-between w-100 pe-3"><span class="fw-semibold">https://competitor2.com</span><span class="badge bg-warning text-dark">Ganador: Empate</span></div></button></h2>
            <div class="accordion-collapse collapse item-2" role="tabpanel" data-bs-parent="#comparisonsAccordion" aria-labelledby="heading2" id="collapse2">
              <div class="accordion-body">
                <h6 class="fw-bold mb-3">Recomendaciones</h6>
                <div class="list-group">
                  <div class="list-group-item">
                    <div class="d-flex w-100 justify-content-between align-items-center">
                      <h6 class="mb-1">Mejorar velocidad de carga</h6><span class="badge bg-info text-dark">Prioridad Baja</span>
                    </div><small class="text-muted">Categoría: performance</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cerrar</button><button class="btn btn-primary" type="button">Exportar Reporte</button></div>
    </div>
  </div>
</div>
