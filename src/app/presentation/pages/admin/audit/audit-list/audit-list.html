<div class="row mb-5">
  <div class="col-12 text-center">
    <h1 class="display-4 fw-light mb-2"><i class="text-primary bi bi-globe2"></i> {{ 'audits.title' | translate }}</h1>
    <p class="fs-6 text-muted">{{ 'audits.subtitle' | translate }}</p>
  </div>
</div>
<div class="row mb-4">
  <div class="col-12 mx-auto">
    <div class="card rounded-3 border-0 shadow-sm">
      <div class="card-body p-4">
        @if (!isLoading() && cItems().data.length > 0) {
          <div class="row align-items-center g-3">
            <div class="col-12 col-lg-8">
              <app-filter-list class="w-100" [data]="cItems()" (dataChange)="items.set($event)" [config]="configFilter()" ></app-filter-list>
            </div>
            <div class="col-12 col-lg-4">
              <div class="d-flex gap-2">
                <a class="btn btn-primary rounded-2 flex-fill" routerLink="/admin/audit/create">
                  <i class="me-1 bi bi-plus-circle"></i> {{ 'audits.buttons.new' | translate }}
                </a>
                <a class="btn btn-outline-secondary rounded-2 flex-fill" routerLink="/admin/target">
                  <i class="me-1 bi bi-clipboard-check"></i>{{ 'audits.buttons.pages' | translate }}
                </a>
              </div>
            </div>
          </div>
        }
        <div class="row mt-4">
          @if (!isLoading() && items().data.length > 0){
            <app-table [data]="items()" [labels]="tableColumn()"></app-table>
            <div  class="mt-5" >
              <app-paginator-list [data]="items()" (dataChange)="items.set($event)"></app-paginator-list>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>

<app-default-modal classModalDialog="modal-xl" [expanded]="showItem()?.id != null">
  <app-header-modal classModal="bg-gradient border-0 py-3 bg-primary">
    <div>
      <h5 class="fw-bold text-white modal-title" id="reportModalLabel">
        <i class="me-2 bi bi-file-earmark-text"></i>{{ 'audits.modal.title' | translate }}
      </h5>
      <p class="text-white-50 mt-1 mb-0 small">ID: {{showItem()?.id}}</p>
    </div>
    <button class="btn-close btn-close-white" [attr.aria-label]="'general.actions.close' | translate" (click)="showItem.set(null)" type="button"></button>
  </app-header-modal>
  <app-body-modal>
    <div class="row g-4">
      @if (showItem()?.error_message) {
        <div class="col-12">
          <div class="alert alert-danger border-0 shadow-sm d-flex align-items-center" role="alert">
            <i class="fs-4 me-3 bi bi-exclamation-triangle-fill"></i>
            <div>
              <h6 class="mb-1 alert-heading">{{ 'audits.modal.error.title' | translate }}</h6>
              <p class="mb-0">{{showItem()?.error_message}}</p>
            </div>
          </div>
        </div>
      }
      <div class="col-md-6">
        <div class="card h-100 bg-light border-0">
          <div class="card-body">
            <h6 class="fw-semibold text-muted mb-3 card-subtitle">
              <i class="me-2 bi bi-info-circle"></i>{{ 'audits.modal.generalInfo.title' | translate }}
            </h6>
            <ul class="list-unstyled mb-0">
              <li class="d-flex justify-content-between mb-2">
                <span class="text-muted">{{ 'audits.modal.generalInfo.status' | translate }}:</span>
                <span class="badge px-3 py-2" [ngClass]="[statusAuditUtil.getStatusText(showItem()?.status ?? '')]">
                  {{statusAuditUtil.getStatusText(showItem()?.status)}}
                </span>
              </li>
              <li class="d-flex justify-content-between mb-2">
                <span class="text-muted">{{ 'audits.modal.generalInfo.createdDate' | translate }}:</span>
                <strong>{{showItem()?.created_at | dateFormat:'short': 'es': true}}</strong>
              </li>
              <li class="d-flex justify-content-between mb-2">
                <span class="text-muted">{{ 'audits.modal.generalInfo.finishedDate' | translate }}:</span>
                <strong>{{showItem()?.completed_at | dateFormat:'short': 'es': true}}</strong>
              </li>
              <li class="d-flex justify-content-between mb-2">
                <span class="text-muted">{{ 'audits.modal.generalInfo.webPageId' | translate }}:</span>
                <small class="font-monospace">{{showItem()?.web_page_id}}</small>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100 bg-light border-0">
          <div class="card-body">
            <h6 class="fw-semibold text-muted mb-3 card-subtitle">
              <i class="me-2 bi bi-speedometer2"></i>{{ 'audits.modal.metrics.title' | translate }}
            </h6>
            <div class="row g-3">
              <div class="col-6">
                <div class="text-center bg-white rounded p-3">
                  <div class="text-muted mb-1 small"><span>{{ 'audits.modal.metrics.performance' | translate }}</span></div>
                  <div class="fs-5 fw-bold text-muted">
                    <span>
                      @if (showItem()?.performance_score) {
                        {{showItem()?.performance_score}}
                      } @else {
                        {{ 'audits.modal.metrics.na' | translate }}
                      }
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="text-center bg-white rounded p-3">
                  <div class="text-muted mb-1 small"><span>{{ 'audits.modal.metrics.seo' | translate }}</span></div>
                  <div class="fs-5 fw-bold text-muted">
                  <span>
                      @if (showItem()?.seo_score) {
                        {{showItem()?.seo_score}}
                      } @else {
                        {{ 'audits.modal.metrics.na' | translate }}
                      }
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="text-center bg-white rounded p-3">
                  <div class="text-muted mb-1 small"><span>{{ 'audits.modal.metrics.accessibility' | translate }}</span></div>
                  <div class="fs-5 fw-bold text-muted">
                    <span>
                      @if (showItem()?.accessibility_score) {
                        {{showItem()?.accessibility_score}}
                      } @else {
                        {{ 'audits.modal.metrics.na' | translate }}
                      }
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="text-center bg-white rounded p-3">
                  <div class="text-muted mb-1 small"><span>{{ 'audits.modal.metrics.bestPractices' | translate }}</span></div>
                  <div class="fs-5 fw-bold text-muted">
                    <span>
                      @if (showItem()?.best_practices_score) {
                        {{showItem()?.best_practices_score}}
                      } @else {
                        {{ 'audits.modal.metrics.na' | translate }}
                      }
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0 py-3">
            <h6 class="fw-semibold mb-0">
              <i class="text-primary me-2 bi bi-clipboard-data"></i>{{ 'audits.modal.lighthouse.title' | translate }}
            </h6>
          </div>
          <div class="card-body">
            <div class="alert alert-secondary mb-0" role="alert">
              <i class="me-2 bi bi-info-circle"></i><span> {{ 'audits.modal.lighthouse.noData' | translate }} </span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0 py-3">
            <h6 class="fw-semibold mb-0">
              <i class="text-success me-2 bi bi-robot"></i>{{ 'audits.modal.ai.title' | translate }}
            </h6>
          </div>
          <div class="card-body">
            <div class="alert alert-secondary mb-0" role="alert">
              @if (showItem()?.ai_suggestions) {
                {{showItem()?.ai_suggestions?.analysis}}
              } @else {
                <i class="me-2 bi bi-info-circle"></i><span> {{ 'audits.modal.ai.noData' | translate }} </span>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  </app-body-modal>
  <app-footer-modal>
    <button class="btn btn-secondary rounded-pill px-4" (click)="showItem.set({})" type="button">
      <i class="me-2 bi bi-x-circle"></i>{{ 'audits.modal.buttons.close' | translate }}
    </button>
    <button class="btn btn-primary rounded-pill px-4" type="button">
      <i class="me-2 bi bi-download"></i>{{ 'audits.modal.buttons.download' | translate }}
    </button>
  </app-footer-modal>
</app-default-modal>
