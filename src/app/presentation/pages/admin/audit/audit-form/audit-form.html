<div class="container-form">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-end gap-2 p-3">
        <a class="btn btn-outline-secondary btn-sm" routerLink="/admin/audit">
          <i class="me-1 bi bi-list-check"></i>{{ 'audits.form.viewAudits' | translate }}
        </a>
        <a class="btn btn-outline-secondary btn-sm" routerLink="/admin/target">
          <i class="me-1 bi bi-gear"></i>{{ 'audits.form.managePages' | translate }}
        </a>
      </div>
    </div>
  </div>
  <div class="row justify-content-center" style="margin-top:15vh;">
    <div class="col-lg-6 col-xl-5">
      <div class="text-center mb-5">
        <i class="text-primary bi bi-shield-check" style="font-size:5rem;"></i>
        <h1 class="fw-bold text-primary mt-3">{{ 'audits.form.title' | translate }}</h1>
      </div>
      @if (error()) {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          {{error() | translate}}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      }
      <form id="auditForm" [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <select
            class="shadow-sm form-select form-select-lg custom-select"
            id="targetSelect"
            formControlName="web_page_id"
            aria-describedby="validationWebPageId"
            [ngClass]="{'is-invalid': messages('web_page_id').length > 0}">
            <option value="" selected disabled>{{ 'audits.form.selectPage' | translate }}</option>
            @for (target of targetSearchList(); track target.id){
              <option [value]="target.id">{{target.name}}</option>
            }
          </select>
          @for(msg of messages('web_page_id'); track msg){
            <div id="validationWebPageId" class="invalid-feedback">
              {{msg}}
            </div>
          }
        </div>
        <div class="d-flex justify-content-center mb-4">
          <div class="form-check form-switch">
            <input
              type="checkbox"
              formControlName="include_ai_analysis"
              class="form-check-input"
              id="aiAnalysisSwitch"
              role="switch" style="width:3rem;height:1.5rem;cursor:pointer;">
            <label class="ms-2 form-check-label" for="aiAnalysisSwitch" style="cursor:pointer;font-size:0.95rem;">
              <i class="text-primary me-1 bi bi-cpu"></i>{{ 'audits.form.includeAI' | translate }}
            </label>
          </div>
        </div>
        <div class="d-flex justify-content-center gap-2">
          <button class="btn btn-primary btn-lg shadow-sm px-4 py-2" type="submit">
            <i class="me-2 bi bi-search"></i>{{ 'audits.form.auditButton' | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<app-default-modal [expanded]="showMessageConfirmation()">
  <app-header-modal>
    <h5 class="text-primary modal-title" id="responseModalLabel">
      <i class="me-2 bi bi-check-circle-fill"></i>
      {{ 'audits.form.confirmModal.title' | translate }}
    </h5>
    <button class="btn-close" aria-label="Close" (click)="showMessageConfirmation.set(false)" type="button"></button>
  </app-header-modal>

  <app-body-modal>
    <div class="alert alert-info mb-3" role="alert">
      <strong>{{ 'audits.form.confirmModal.message' | translate }} </strong>
      <span id="modalMessage"> {{responseCreateAudit().message}}</span>
    </div>
    <div class="mb-2">
      <strong>{{ 'audits.form.confirmModal.status' | translate }} </strong>
      <span class="badge bg-warning text-dark" id="modalStatus"> {{statusAuditUtil.getStatusText(responseCreateAudit().status)}}</span>
    </div>
    <div class="mb-2">
      <strong>{{ 'audits.form.confirmModal.taskId' | translate }} </strong>
      <code id="modalTaskId"> {{responseCreateAudit().task_id}}</code>
    </div>
  </app-body-modal>
  <app-footer-modal>
    <div class="modal-footer border-0">
      <button class="btn btn-secondary" (click)="showMessageConfirmation.set(false)" type="button">{{ 'audits.form.confirmModal.acceptButton' | translate }}</button>
      <a class="btn btn-primary" id="viewAuditsBtn" routerLink="/admin/audit">
        <i class="me-1 bi bi-list-check"></i>{{ 'audits.form.confirmModal.viewListButton' | translate }}
      </a>
    </div>
  </app-footer-modal>

</app-default-modal>
